<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Coalition Builder</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
        body {
            color: black;
            font-family: 'Tahoma';
        }

        h3 {
            font-family: 'Tahoma';
            color: black;
            text-align: center;
            vertical-align: top;
            font-size: 20px;
            padding: 5px;
            margin: 5px;
        }

        h2 {
            font-family: 'Brush Script MT';
            text-align: center;
            font-size: 50px;
        }

        b {
            font-family: 'Tahoma';
        }

        button {
            padding: 5px;
            font-size: 25px;
            height: 100%;
            width: 100%;
        }

        input {
            width: 110%
        }

        .Color {
            width: 50%;
        }

        .small {
            font-size: 9px
        }

        div {
        }

        .Button {
            padding: 5px;
        }

        .scrollable {
            height: 100%;
            overflow-y: auto;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 20px;
        }

            /* Hide default HTML checkbox */
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        /* The slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

            .slider:before {
                position: absolute;
                content: "";
                height: 10px;
                width: 10px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                -webkit-transition: .4s;
                transition: .4s;
            }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(40px);
            -ms-transform: translateX(40px);
            transform: translateX(40px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

            .slider.round:before {
                border-radius: 50%;
            } 

        .td {
            border: "solid";
        }

        .PollRow {
            background-color: #ffff;
        }

        .PollRow:hover {
                background-color: #b6ff00;
        }

        .highcharts-figure,
        .highcharts-data-table table {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div>
        <h2>Schmillies Tasmanian Coaliton Calculator 
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/11/Tasmania_location_map_alt.png" 
             style="height:55px;" />
             </h2> 
    </div>
    <div class="container-fluid" style="height:100%;width:100%;padding:2px;">
        <div id="TopRow" class="row" >
            <div class="col-md-4" style="border-style:solid;height:50%;">
                <div id="ChartID">
                    <canvas style="width:50%" id="SmoothCircle">
                    </canvas>
                </div>
                <h3>Click on a party to add the to a coaliton.</h3>
            </div>
            <div class="col-md-1" id="RightChartInfo" >
                <h3>Majority Needed <br /> <b id="Threshold">50</b> </h3>
                <h3>Currently Selected <br /> <b id="CurrentValue">0</b> </h3>
                <h3>Majority: <br /> <b id="Majority">false</b></h3>
                <h3>Lock to: <b id="MaxCount"></b></h3>
                <label class="switch">
                    <input onclick="LockCheck()" type="checkbox" id="CheckBox">
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="col-md-2">
                <h3>
                    <b>Type:</b><br /> <text id="Type"></text>
                </h3>
                <h3 class="scrollable">
                    Selected Parties: <b id="elementList"></b>
                </h3>
            </div>
            <div class="col-md-2">
                <button onclick="ChangeMode()"><text>Mode Change</text> <br/> <text class="small" >Toggle between Seat Mode and % Mode</text></button>
                <button onclick="getPartyCount()">Refresh Data</button>
                <button onclick="buttonClear()">Clear</button> 

            </div>
            <div class="col-md-3 Poll" style="height:50%;border-style:solid none solid solid;">
                <h3>
                    Based on Poll:
                </h3>
                <div class="scrollable" style="height:200px">
                    <table id="pollingData" style="width:100%;height:30px">
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="BoxesContainer" class="row" style="padding:1%;border">
        <div id="PartyRow1" class="PartyRow">
        </div>
        <div id="PartyRow2" class="PartyRow">
        </div>
        <div id="PartyRow3" class="PartyRow">
        </div>
    </div>
    <div class="row"><div style="padding-left: 10%;" class="col">
    <b> Known Bugs: </b>
    <ul>
        <li>- Seat mode broken, currently does not interact with coaltion, unable to click on parties to add them to coaliton</li>
        <li>- Seat mode takes up way too much of page and leaves large white space</li>
        <li>- Currently doesn't doesn't allow for adding parties, can only change current values</li>
        <li>- Lock button has major issues, especially when interacting with 0</li>
        <li>- Total Button doesn't work</li>
    </ul>
    If you find any additonal issues please report them to <a href="mailto:schmilly@proton.me">my email</a>
    </div>
    </div>
</body>
</html>
<script src="./polling.js"></script>
<script src="./functions.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/item-series.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script>
    var ctx = document.getElementById('SmoothCircle');
    var Type = PollingData[0].Level;
    var PartyCount = PollingData[0].Count;
    var PartyData = PollingData[0].PartyData;
    var SeatCount = PollingData[0].SeatProj;
    var PrtyLabels = PollingData[0].PartyLabels;
    var colors = PollingData[0].PartyColor;
    var SeatMajority = PollingData[0].SeatMajor;
    var TotalPrim = ArraySum(PollingData[0].PartyData);
    var TotalSeat = ArraySum(PollingData[0].SeatProj);
    var SeatMax = PollingData[0].SeatMax;
    var Max = 100;
    var Selected = [];
    var Row = 1;
    var CurrentTotal = 1;
    var CountLock = 0;
    //0 for unlock, 1 for Lock
    var Seat = 0;
    //0 for % mode, 1 for Seat Mode

    var SmoothData = {
        type: 'doughnut',
        data: {
            labels: PrtyLabels,
            datasets: [{
                label: '%',
                data: PartyData,
                borderWidth: 1,
                backgroundColor: colors
            }]
        },
        options: {
            rotation: -90,
            circumference: 180,
            maintainAspectRatio: false,
            onClick: handleChartClick,
            plugins: {
                legend: {
                    position: "bottom",
                }
            }
        }
    };

    ParlimentData = generateParlimentdata(colors, PrtyLabels, SeatCount, PartyCount);
    var HighChartsData = {
        chart: {
            height: '100%',
            type: 'item',
        },
        title: {
            text: "",
        },
        series: [{
            name: 'Seats',
            keys: ['name', 'y', 'color'],
            data: ParlimentData,
            dataLabels: {
                enabled: false,
            },

            // Circular options
            startAngle: -90,
            endAngle: 90
        }],
        plotOptions: {
            series: {
                states: {
                    inactive: {
                        opacity: 1
                    }
                }
            }
        },
    pane: [{
        startAngle: -45,
        endAngle: 45,
        background: null,
        center: ['25%', '145%'],
        size: 300
    }]
    };

    createPage();
    RenderChart();
    grabPolling();
    PullPageValues();
    LockCheck();
</script>
